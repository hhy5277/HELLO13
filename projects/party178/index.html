<!DOCTYPE HTML>
<html>
    <head>
        <meta charset="utf-8">
        <title>178</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
        <meta name="format-detection" content="telephone=no" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black" />
        <!-- common css -->
        <link rel="stylesheet" type="text/css" href="static/css/common.css">
        <link rel="stylesheet" type="text/css" href="static/css/swiper.css">
        <link rel="stylesheet" type="text/css" href="static/js/ps/photoswipe.css">
        <link rel="stylesheet" type="text/css" href="static/js/ps/default-skin/default-skin.css">
        <link rel="stylesheet" type="text/css" href="static/css/screen.css">
        <!-- common css end -->
    </head>
    <body ontouchstart="">
        <header class="navbar ui-border-b">
            <div id="selectCityBtn" class="pos pos-left l-gray">
                <a class="l-city">北京<i class="icon-arrowdown"></i></a>
            </div>
            <h2 class="hdtitle ui-nowrap">
                <a href="/mobile/">
                    <img class="logo" src="static/img/logo.png" alt="178" />发起邀约
                </a>
            </h2>
            <!-- 若未登录，则不显示此div -->
            <div class="navbar-user pos pos-right c-lgray l-lgray">
                <div class="nav-user">
                    <a href="">
                        <div class="avatar-hd">
                            <!-- 若登录为提交头像则显示照相机，否则显示头像 -->
                            <!-- <img src="static/img/icon-photo.jpg" /> -->
                            <img src="static/img/avatar.png" />
                        </div>
                    </a>
                </div>
            </div>
        </header><!-- header end -->
        <div class="c">
            <div class="index">
                <div class="thumbnail ui-border-b">
                    <div class="pic">
                        <a href="detail.html"><img data-original="static/img/activity.png" /></a>
                    </div>
                    <div class="caption">
                        <div class="link" data-href="">
                            <!-- 第一标题 -->
                            <h3>行走意大利，寻找旅行的意义</h3>
                            <!-- 第二标题 -->
                            <!-- <p class="f-16 mb5">地道湖南湘味，正宗家乡食材，只为&ldquo;怕不辣&rdquo;&nbsp;&nbsp;&nbsp; </p> -->
                            <p class="mb5"><i class="icon-date"></i><span class="f-14 c-lgray2">组局时间：2015-09-23 19:00 星期三</span></p>
                            <div class="rel">
                                <span class="f-22 c-gold">198元</span><span class="f-14 c-lgray2">/位</span>
                                <div>
                                    <span>
                                        <span class="f-14 c-lgray5">三里屯</span>
                                    </span>
                                    <span class="icon-indexwrap abs f-14 c-lgray6 avatar">
                                        <img src="static/img/avatar.png" alt="">
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div><!-- thumbnail end -->
            </div>
            <div class="index">
                <div class="thumbnail ui-border-b">
                    <div class="pic">
                        <a href=""><img data-original="" /></a>
                    </div>
                    <div class="caption">
                        <div class="link" data-href="">
                            <h3>神的孩子都去尼泊尔</h3>
                            <!-- <p class="f-16 mb5">地道湖南湘味，正宗家乡食材，只为&ldquo;怕不辣&rdquo;&nbsp;&nbsp;&nbsp; </p> -->
                            <p class="mb5"><i class="icon-date"></i><span class="f-14 c-lgray2">组局时间：2015-09-23 19:00 星期三</span></p>
                            <div class="rel">
                                <span class="f-22 c-gold">198元</span><span class="f-14 c-lgray2">/位</span>
                                <div>
                                    <span>
                                        <span class="f-14 c-lgray5">三里屯</span>
                                    </span>
                                    <span class="icon-indexwrap abs f-14 c-lgray6 avatar">
                                        <img src="static/img/avatar.png" alt="">
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div><!-- thumbnail end -->
            </div>
        </div>
        <div id="selectCity" class="overlay-slidedown">
            <div class="city-wrap">
                <h4>选择服务的城市</h4>
                <ul>
                    <li><a href="/mobile?city=北京">北京</a></li>
                    <li><a href="/mobile?city=上海">上海</a></li>
                </ul>
            </div>
        </div>
        <!-- common js -->
        <script src="static/js/jquery.min.js"></script>
        <script src="static/js/jquery.lazyload.min.js"></script>
        <script src="static/js/jquery.swiper.min.js"></script>
        <script src="static/js/jquery.idtabs.min.js"></script>
        <script src="static/js/jquery.pin.min.js"></script>
        <script src="static/js/ps/photoswipe.min.js"></script>
        <script src="static/js/ps/photoswipe-ui-default.min.js"></script>
        <!-- common js end -->
        <script>
            $(function() {
                $("img").lazyload({
                    effect: "fadeIn",
                    threshold: 400,
                });

                //选择城市
                $("#selectCityBtn, #selectCity").click(function(){
                    $("#selectCity").toggleClass("open");
                });

                //幻灯片
                var swiper = new Swiper('.swiper-container', {
                    pagination: '.swiper-pagination',
                    paginationClickable: true,
                    // Disable preloading of all images
                    preloadImages: false,
                    // Enable lazy loading
                    lazyLoading: true,
                });

                //添加列表链接
                $('.link, .link-list li').click(function(){
                    location.href= $(this).data('href');
                });

                //选项卡
                $("#Tab1 ul").idTabs();
                $("#Tab2 ul").idTabs();

                //固定选项卡
                $(".pinned").pin({
                    containerSelector: ".container",
                    padding: {top: 55}
                });

                //弹出图片
                var initPhotoSwipeFromDOM = function(gallerySelector) {

                    // parse slide data (url, title, size ...) from DOM elements 
                    // (children of gallerySelector)
                    var parseThumbnailElements = function(el) {
                        var thumbElements = el.childNodes,
                            numNodes = thumbElements.length,
                            items = [],
                            figureEl,
                            childElements,
                            linkEl,
                            size,
                            item;

                        for(var i = 0; i < numNodes; i++) {


                            figureEl = thumbElements[i]; // <figure> element

                            // include only element nodes
                            if(figureEl.nodeType !== 1) {
                                continue;
                            }
                            linkEl = figureEl.children[0]; // <a> element
                            size = linkEl.getAttribute('data-size').split('x');

                            // create slide object
                            item = {
                                src: linkEl.getAttribute('href'),
                                w: parseInt(size[0], 10),
                                h: parseInt(size[1], 10)
                            };
                            if(figureEl.children.length > 1) {
                                // <figcaption> content
                                item.title = figureEl.children[1].innerHTML; 
                            }
                            if(linkEl.children.length > 0) {
                                // <img> thumbnail element, retrieving thumbnail url
                                item.msrc = linkEl.children[0].getAttribute('src');
                            }
                            item.el = figureEl; // save link to element for getThumbBoundsFn
                            items.push(item);
                        }

                        return items;
                    };

                    // find nearest parent element
                    var closest = function closest(el, fn) {
                        return el && ( fn(el) ? el : closest(el.parentNode, fn) );
                    };

                    // triggers when user clicks on thumbnail
                    var onThumbnailsClick = function(e) {
                        e = e || window.event;
                        e.preventDefault ? e.preventDefault() : e.returnValue = false;

                        var eTarget = e.target || e.srcElement;

                        var clickedListItem = closest(eTarget, function(el) {
                            return el.tagName === 'FIGURE';
                        });

                        if(!clickedListItem) {
                            return;
                        }

                        // find index of clicked item
                        var clickedGallery = clickedListItem.parentNode,
                            childNodes = clickedListItem.parentNode.childNodes,
                            numChildNodes = childNodes.length,
                            nodeIndex = 0,
                            index;
                        for (var i = 0; i < numChildNodes; i++) {
                            if(childNodes[i].nodeType !== 1) {
                                continue;
                            }

                            if(childNodes[i] === clickedListItem) {
                                index = nodeIndex;
                                break;
                            }
                            nodeIndex++;
                        }
                        if(index >= 0) {
                            openPhotoSwipe( index, clickedGallery );
                        }
                        return false;
                    };

                    // parse picture index and gallery index from URL (#&pid=1&gid=2)
                    var photoswipeParseHash = function() {
                        var hash = window.location.hash.substring(1),
                        params = {};

                        if(hash.length < 5) {
                            return params;
                        }
                        var vars = hash.split('&');
                        for (var i = 0; i < vars.length; i++) {
                            if(!vars[i]) {
                                continue;
                            }
                            var pair = vars[i].split('=');
                            if(pair.length < 2) {
                                continue;
                            }
                            params[pair[0]] = pair[1];
                        }

                        if(params.gid) {
                            params.gid = parseInt(params.gid, 10);
                        }

                        if(!params.hasOwnProperty('pid')) {
                            return params;
                        }
                        params.pid = parseInt(params.pid, 10);
                        return params;
                    };

                    var openPhotoSwipe = function(index, galleryElement, disableAnimation) {
                        var pswpElement = document.querySelectorAll('.pswp')[0],
                            gallery,
                            options,
                            items;

                        items = parseThumbnailElements(galleryElement);

                        // define options (if needed)
                        options = {
                            index: index,

                            // define gallery index (for URL)
                            galleryUID: galleryElement.getAttribute('data-pswp-uid'),

                            getThumbBoundsFn: function(index) {
                                // See Options -> getThumbBoundsFn section of docs for more info
                                var thumbnail = items[index].el.getElementsByTagName('img')[0], // find thumbnail
                                    pageYScroll = window.pageYOffset || document.documentElement.scrollTop,
                                    rect = thumbnail.getBoundingClientRect();

                                return {x:rect.left, y:rect.top + pageYScroll, w:rect.width};
                            },

                            // history & focus options are disabled on CodePen
                            // remove these lines in real life:
                           historyEnabled: false,
                           focus: false,
                           loop: false

                        };

                        if(disableAnimation) {
                            options.showAnimationDuration = 0;
                        }

                        // Pass data to PhotoSwipe and initialize it
                        gallery = new PhotoSwipe( pswpElement, PhotoSwipeUI_Default, items, options);
                        gallery.init();
                    };

                    // loop through all gallery elements and bind events
                    var galleryElements = document.querySelectorAll( gallerySelector );

                    for(var i = 0, l = galleryElements.length; i < l; i++) {
                        galleryElements[i].setAttribute('data-pswp-uid', i+1);
                        galleryElements[i].onclick = onThumbnailsClick;
                    }

                    // Parse URL and open gallery if it contains #&pid=3&gid=1
                    var hashData = photoswipeParseHash();
                    if(hashData.pid > 0 && hashData.gid > 0) {
                        openPhotoSwipe( hashData.pid - 1 ,  galleryElements[ hashData.gid - 1 ], true );
                    }
                };

                // execute above function
                initPhotoSwipeFromDOM('.my-gallery');
            });
        </script>
    </body>
</html>
                    